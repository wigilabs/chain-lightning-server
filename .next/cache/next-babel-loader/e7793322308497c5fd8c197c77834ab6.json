{"ast":null,"code":"const superagent = require('superagent');\n\nconst handler = (req, res) => {\n  let events;\n  superagent.get('https://insights-api.newrelic.com/v1/accounts/2482859/query?nrql=SELECT+*+FROM+NagiosReport+SINCE+5+minutes+ago').set('X-Query-Key', 'NRIQ-j7zJFckfarn9jsOB-nPscK5H6z0QCgHd').set('Accept', 'application/json').end((err, response) => {\n    events = JSON.parse(response.text).results[0].events;\n    let dObj = events[0]; //console.log('events: ', dObj)\n\n    let value_load = dObj['Current Load\\n'].includes('CRITICAL') || dObj['Current Load\\n'].includes('WARNING') || dObj['Current Load\\n'].includes('WARNING:') ? 0 : 1; //value_load=dObj['Current Load\\n'].includes('WARNING') ? 0 : 1\n    //value_load=dObj['Current Load\\n'].includes('WARNING:') ? 0 : 1\n\n    let value_users = dObj['Current Users\\n'].includes('CRITICAL') || dObj['Current Users\\n'].includes('WARNING') || dObj['Current Users\\n'].includes('WARNING:') ? 0 : 1; //value_users=dObj['Current Users\\n'].includes('WARNING')  ? 0 : 1;\n    //value_users=dObj['Current Users\\n'].includes('WARNING:')  ? 0 : 1;\n\n    let value_http = dObj['HTTP\\n'].includes('CRITICAL') || dObj['HTTP\\n'].includes('WARNING') || dObj['HTTP\\n'].includes('WARNING:') ? 0 : 1; //value_http=dObj['HTTP\\n'].includes('WARNING') ? 0 : 1;\n    //value_http=dObj['HTTP\\n'].includes('WARNING:') ? 0 : 1;\n\n    let ping_value = dObj['PING\\n'].includes('CRITICAL') || dObj['PING\\n'].includes('WARNING') || dObj['PING\\n'].includes('WARNING:') ? 0 : 1; //ping_value=dObj['PING\\n'].includes('WARNING') ? 0 : 1;\n    //ping_value=dObj['PING\\n'].includes('WARNING:') ? 0 : 1;\n\n    let root_partition = dObj['Root Partition\\n'].includes('CRITICAL') || dObj['Root Partition\\n'].includes('WARNING') || dObj['Root Partition\\n'].includes('WARNING:') ? 0 : 1; //root_partition=dObj['Root Partition\\n'].includes('WARNING')  ? 0 : 1;\n    //root_partition=dObj['Root Partition\\n'].includes('WARNING:')  ? 0 : 1;\n\n    let ssh_value = dObj['SSH\\n'].includes('CRITICAL') || dObj['SSH\\n'].includes('WARNING') || dObj['SSH\\n'].includes('WARNING:') ? 0 : 1; //ssh_value=dObj['SSH\\n'].includes('WARNING') ? 0 : 1;\n    //ssh_value=dObj['SSH\\n'].includes('WARNING:') ? 0 : 1;\n\n    let swap_value = dObj['Swap Usage\\n'].includes('CRITICAL') || dObj['Swap Usage\\n'].includes('WARNING') || dObj['Swap Usage\\n'].includes('WARNING:') ? 0 : 1; //swap_value=dObj['Swap Usage\\n'].includes('WARNING') ? 0 : 1;\n    //swap_value=dObj['Swap Usage\\n'].includes('WARNING:') ? 0 : 1;\n\n    let total_value = dObj['Total Processes\\n'].includes('CRITICAL') || dObj['Total Processes\\n'].includes('WARNING') || dObj['Total Processes\\n'].includes('WARNING:') ? 0 : 1; //total_value=dObj['Total Processes\\n'].includes('WARNING') ? 0 : 1;\n    //total_value=dObj['Total Processes\\n'].includes('WARNING:') ? 0 : 1;\n    //detalles\n\n    let detail_load = dObj['Current Load\\n'];\n    let detail_users = dObj['Current Users\\n'];\n    let detail_http = dObj['HTTP\\n'];\n    let detail_ping = dObj['PING\\n'];\n    let detail_root_patition = dObj['Root Partition\\n'];\n    let detail_ssh = dObj['SSH\\n'];\n    let detail_swap = dObj['Swap Usage\\n'];\n    let detail_total = dObj['Total Processes\\n']; //final object\n\n    events = [{\n      name: 'Current Load',\n      value: value_load,\n      msg: detail_load\n    }, {\n      name: 'Current Users',\n      value: value_users,\n      msg: detail_users\n    }, {\n      name: 'HTTP',\n      value: value_http,\n      msg: detail_http\n    }, {\n      name: 'PING',\n      value: ping_value,\n      msg: detail_ping\n    }, {\n      name: 'Root Partition',\n      value: root_partition,\n      msg: detail_root_patition\n    }, {\n      name: 'SSH',\n      value: ssh_value,\n      msg: detail_ssh\n    }, {\n      name: 'Swap Usage',\n      value: swap_value,\n      msg: detail_swap\n    }, {\n      name: 'Total Processes',\n      value: total_value,\n      msg: detail_total\n    }];\n    console.log(events);\n    return res.json(events);\n  });\n};\n\nexport default handler;","map":{"version":3,"sources":["C:/Users/fsoler/Desktop/chain-lightning-server/pages/api/nagios-events.js"],"names":["superagent","require","handler","req","res","events","get","set","end","err","response","JSON","parse","text","results","dObj","value_load","includes","value_users","value_http","ping_value","root_partition","ssh_value","swap_value","total_value","detail_load","detail_users","detail_http","detail_ping","detail_root_patition","detail_ssh","detail_swap","detail_total","name","value","msg","console","log","json"],"mappings":"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","sourcesContent":["const superagent = require('superagent');\r\n\r\nconst handler = (req, res) => {\r\n  let events\r\n  superagent\r\n    .get('https://insights-api.newrelic.com/v1/accounts/2482859/query?nrql=SELECT+*+FROM+NagiosReport+SINCE+5+minutes+ago')\r\n    .set('X-Query-Key', 'NRIQ-j7zJFckfarn9jsOB-nPscK5H6z0QCgHd')\r\n    .set('Accept', 'application/json')\r\n    .end((err, response) => {\r\n      events = JSON.parse(response.text).results[0].events\r\n      let dObj=events[0]\r\n      //console.log('events: ', dObj)\r\n      let value_load=dObj['Current Load\\n'].includes('CRITICAL') || dObj['Current Load\\n'].includes('WARNING') || dObj['Current Load\\n'].includes('WARNING:') ? 0 : 1\r\n\t  //value_load=dObj['Current Load\\n'].includes('WARNING') ? 0 : 1\r\n\t  //value_load=dObj['Current Load\\n'].includes('WARNING:') ? 0 : 1\r\n      let value_users=dObj['Current Users\\n'].includes('CRITICAL') || dObj['Current Users\\n'].includes('WARNING') || dObj['Current Users\\n'].includes('WARNING:') ? 0 : 1;\r\n\t  //value_users=dObj['Current Users\\n'].includes('WARNING')  ? 0 : 1;\r\n\t  //value_users=dObj['Current Users\\n'].includes('WARNING:')  ? 0 : 1;\r\n      let value_http=dObj['HTTP\\n'].includes('CRITICAL') || dObj['HTTP\\n'].includes('WARNING') || dObj['HTTP\\n'].includes('WARNING:') ? 0 : 1;\r\n\t  //value_http=dObj['HTTP\\n'].includes('WARNING') ? 0 : 1;\r\n\t  //value_http=dObj['HTTP\\n'].includes('WARNING:') ? 0 : 1;\r\n      let ping_value=dObj['PING\\n'].includes('CRITICAL') || dObj['PING\\n'].includes('WARNING') || dObj['PING\\n'].includes('WARNING:') ? 0 : 1;\r\n\t  //ping_value=dObj['PING\\n'].includes('WARNING') ? 0 : 1;\r\n\t  //ping_value=dObj['PING\\n'].includes('WARNING:') ? 0 : 1;\r\n      let root_partition=dObj['Root Partition\\n'].includes('CRITICAL') || dObj['Root Partition\\n'].includes('WARNING') || dObj['Root Partition\\n'].includes('WARNING:') ? 0 : 1;\r\n\t  //root_partition=dObj['Root Partition\\n'].includes('WARNING')  ? 0 : 1;\r\n\t  //root_partition=dObj['Root Partition\\n'].includes('WARNING:')  ? 0 : 1;\r\n      let ssh_value=dObj['SSH\\n'].includes('CRITICAL') || dObj['SSH\\n'].includes('WARNING') || dObj['SSH\\n'].includes('WARNING:') ? 0 : 1;\r\n\t  //ssh_value=dObj['SSH\\n'].includes('WARNING') ? 0 : 1;\r\n\t  //ssh_value=dObj['SSH\\n'].includes('WARNING:') ? 0 : 1;\r\n      let swap_value=dObj['Swap Usage\\n'].includes('CRITICAL') || dObj['Swap Usage\\n'].includes('WARNING') || dObj['Swap Usage\\n'].includes('WARNING:') ? 0 : 1;\r\n\t  //swap_value=dObj['Swap Usage\\n'].includes('WARNING') ? 0 : 1;\r\n\t  //swap_value=dObj['Swap Usage\\n'].includes('WARNING:') ? 0 : 1;\r\n      let total_value=dObj['Total Processes\\n'].includes('CRITICAL') || dObj['Total Processes\\n'].includes('WARNING') || dObj['Total Processes\\n'].includes('WARNING:') ? 0 : 1;\r\n\t  //total_value=dObj['Total Processes\\n'].includes('WARNING') ? 0 : 1;\r\n\t  //total_value=dObj['Total Processes\\n'].includes('WARNING:') ? 0 : 1;\r\n\t  //detalles\r\n\t  let detail_load=dObj['Current Load\\n'];\r\n\t  let detail_users=dObj['Current Users\\n'];\r\n\t  let detail_http=dObj['HTTP\\n'];\r\n\t  let detail_ping=dObj['PING\\n'];\r\n\t  let detail_root_patition=dObj['Root Partition\\n'];\r\n\t  let detail_ssh=dObj['SSH\\n'];\r\n\t  let detail_swap=dObj['Swap Usage\\n'];\r\n\t  let detail_total=dObj['Total Processes\\n'];\r\n\t  //final object\r\n      events = [\r\n          { name: 'Current Load',    value: value_load, msg: detail_load},\r\n          { name: 'Current Users',   value: value_users, msg: detail_users },\r\n          { name: 'HTTP',            value: value_http, msg: detail_http },\r\n          { name: 'PING',            value: ping_value, msg: detail_ping },\r\n          { name: 'Root Partition',  value: root_partition, msg: detail_root_patition },\r\n          { name: 'SSH',             value: ssh_value, msg: detail_ssh },\r\n          { name: 'Swap Usage',      value: swap_value, msg: detail_swap },\r\n          { name: 'Total Processes', value: total_value, msg:  detail_total },\r\n        ]\r\n\t  console.log(events);\r\n      return res.json(events);\r\n    });\r\n};\r\nexport default handler;"]},"metadata":{},"sourceType":"module"}